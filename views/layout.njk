<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title or 'Local Online Judge' }}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="ui container" style="margin-top: 20px;">
    <!-- Navigation -->
    <div class="ui secondary pointing menu">
      <a class="item {{ 'active' if active_page == 'home' }}" href="/">
        <i class="home icon"></i> Home
      </a>
      <a class="item {{ 'active' if active_page == 'contests' }}" href="/">
        <i class="trophy icon"></i> Contests
      </a>
      <div class="right menu">
        {% if user %}
          <div class="ui dropdown item">
            <i class="user circle icon"></i>
            {{ user.username }} ({{ user.role }})
            <i class="dropdown icon"></i>
            <div class="menu">
              {% if user.role == 'admin' %}
                <a class="item" href="/admin/problems">
                  <i class="cog icon"></i> Admin Panel
                </a>
                <div class="divider"></div>
              {% endif %}
              <a class="item" href="/logout">
                <i class="sign out icon"></i> Logout
              </a>
            </div>
          </div>
        {% else %}
          <a class="item" href="/login">
            <i class="sign in icon"></i> Login
          </a>
          <a class="item" href="/register">
            <i class="user plus icon"></i> Register
          </a>
        {% endif %}
      </div>
    </div>

    <!-- Security Warning for Production -->
    {% if user and user.role == 'admin' %}
      <div class="ui warning message">
        <i class="warning sign icon"></i>
        <div class="content">
          <div class="header">Security Notice</div>
          <p>This application executes code without sandboxing. Only use in trusted environments!</p>
        </div>
      </div>
    {% endif %}

    <!-- Main Content -->
    {% block content %}{% endblock %}
    
    <!-- Footer -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center; color: #666;">
      <p>
        <small>
          Local Online Judge Platform | 
          <a href="https://github.com/CuteMurasame/local-online-judge" target="_blank">Source Code</a>
        </small>
      </p>
    </div>
  </div>

  <script>
    // Initialize dropdowns
    $('.ui.dropdown').dropdown();
    
    // Form submission loading state
    $('form').on('submit', function() {
      $(this).find('button[type="submit"]').addClass('loading');
    });
    
    // Auto-refresh for judging submissions
    if (window.location.pathname.includes('/submission/')) {
      const statusElement = $('.status-judging');
      if (statusElement.length > 0) {
        setTimeout(function() {
          window.location.reload();
        }, 3000);
      }
    }
  </script>
</body>
</html>
